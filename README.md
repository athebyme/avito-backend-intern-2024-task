# Проект: Сервис тендеров и предложений Avito 2024 backend intern

Мое решение тестового задания от Авито на стажера бэкендера 

---

## Структура проекта

В папке src представлен исходный код приложения

Spring Hibernate - автомиграция. Базы Employee, Organization, Organization_responsible должны иметь какие-либо данные (по условию задания данные уже есть)

есть docker-compose.yml, dockerfile файлы для создания контейнера

---

## Задание

В папке `задание` размещена задача, которая решалась

---

## Запуск приложения на локальном устройстве

### Шаги для запуска:

1. Остановите работающий pod в Kubernetes:
   ```bash
   kubectl rollout restart deployment cnrprod1725773447-team-79619-backend --namespace=cnrprod1725773447-team-79619
   ```
   ⚠️ Примечание: В базе данных может быть лимит подключений. Если запущен под, приложение не сможет создать подключение через Hikari драйвер.

2. Запустите приложение в Docker-контейнере:
   ```bash
   docker-compose up --build
   ```
   Контейнер будет работать на localhost:8080. Можно изменить параметры запуска при необходимости.

## Доступ через хостинг:
### ✅ Приложение уже доступно по адресу: https://cnrprod1725773447-team-79619-33208.avito2024.codenrock.com


### 1. Проверка доступности сервера
- **Эндпоинт:** GET /ping
- **Цель:** Убедиться, что сервер готов обрабатывать запросы.

```yaml
GET /api/ping

Response:

  200 OK

  Body: ok
```

### 2. Тестирование функциональности тендеров
#### 1. Получение списка тендеров
- **Эндпоинт:** GET /tenders
- **Описание:** Метод возвращает список доступных тендеров с возможностью фильтрации по типу услуг. Также доступны параметры для настройки количества возвращаемых записей и указания смещения для постраничного вывода.
#### Параметры запроса:
- `limit` (опционально, по умолчанию: 5): Ограничивает количество возвращаемых тендеров.
- `offset` (опционально, по умолчанию: 0): Указывает смещение для получения последующих записей.
- `service_type` (опционально): Список типов услуг для фильтрации тендеров.

```yaml
GET /api/tenders

Response:

  200 OK

  Body: [ {...}, {...}, ... ]
```

#### 2. Создание нового тендера
- **Эндпоинт:** POST /tenders/new
- **Описание:** Создает новый тендер с заданными параметрами.
#### Параметры запроса:
  
```yaml
POST /api/tenders/new

Request Body:

{
  "name": "Тендер 1",
  "description": "Доставка вкусных пончиков",
  "serviceType": "Delivery",
  "organizationId": "550e8400-e29b-41d4-a716-446655440020",
  "creatorUsername": "user1"
}

Response:

  200 OK

  Body: 
  
{
    "id": "8ff28183-3d7e-41fd-ba97-f23cef173c9a",
    "version": 1,
    "description": "Доставка вкусных пончиков",
    "name": "Тендер 1",
    "creatorUsername": "user1",
    "organization_id": "550e8400-e29b-41d4-a716-446655440020",
    "tender_status": "Created",
    "created_at": "2024-09-16T11:42:02.809+0000"
}

```

#### 3. Получение тендеров пользователя
- **Эндпоинт:** GET /tenders/my
- **Описание:** Возвращает список тендеров текущего пользователя.

#### Параметры запроса:
- `limit` (опционально, по умолчанию: 5): Ограничивает количество возвращаемых тендеров.
- `offset` (опционально, по умолчанию: 0): Указывает смещение для получения последующих записей.
- `username` (обязательный) : Имя пользователя.

```yaml
GET /api/tenders/my?username=user1

Response:

  200 OK

  Body: [ {...}, {...}, ... ]  
```

#### 4. Получение текущего статуса тендера
- **Эндпоинт:** GET /tenders/status
- **Описание:** Возвращает текущий статус тендера.

#### Параметры запроса:
- `tenderId` (обязательный): ID тендера.
- `username ` (обязательный) : Имя пользователя.

```yaml
GET /api/tenders/8ff28183-3d7e-41fd-ba97-f23cef173c9a/status?username=user1

Response:

  200 OK

  Body: 
     "Created"
```

#### 5. Получение текущего статуса тендера
- **Эндпоинт:** PUT /tenders/status
- **Описание:** Возвращает текущий статус тендера.

#### Параметры запроса:
- `tenderId` (обязательный): ID тендера.
- `username ` (обязательный) : Имя пользователя.
- `status` (обязательный) : Новый статус тендера.

```yaml
PUT /api/tenders/8ff28183-3d7e-41fd-ba97-f23cef173c9a/status?username=user1&status=Published

Response:

  200 OK

  Body: 
     {
    "id": "8ff28183-3d7e-41fd-ba97-f23cef173c9a",
    "version": 1,
    "description": "Доставка вкусных пончиков",
    "name": "Тендер 1",
    "creatorUsername": "user1",
    "organization_id": "550e8400-e29b-41d4-a716-446655440020",
    "tender_status": "Published",
    "created_at": "2024-09-16T11:42:02.809+0000"
}
```

#### 6. Редактирование тендера
- **Эндпоинт:** PATCH /tenders/{tenderId}/edit
- **Описание:** Изменение параметров существующего тендера. После успешного изменения текущая версия инкрементируется.
  
#### Параметры запроса:
- `tenderId` (обязательный) : ID тендера.
- `username` (обязательный) : Имя пользователя.
  
```yaml
PATCH /api/tenders/8ff28183-3d7e-41fd-ba97-f23cef173c9a/edit?username=user1

Request Body:

{
  "name": "Новое описание тендера",
  "description": "Какое то описание тендера ля ля ля тополя",
  "serviceType": "Construction"
}

Response:

  200 OK

  Body: 
{
    "id": "8ff28183-3d7e-41fd-ba97-f23cef173c9a",
    "version": 2,
    "description": "Какое то описание тендера ля ля ля тополя",
    "name": "Новое описание тендера",
    "creatorUsername": "user1",
    "organization_id": "550e8400-e29b-41d4-a716-446655440020",
    "tender_status": "Published",
    "created_at": "2024-09-16T11:42:02.809+0000"
}

```

#### 7. Откат версии тендера
- **Эндпоинт:** PUT /tenders/{tenderId}/rollback/{version}
- **Описание:** Откатить параметры тендера к указанной версии. После отката ее версия инкрементируется.
  
#### Параметры запроса:
- `tenderId` (обязательный) : ID тендера.
- `verison` (обязательный) : Версия, к которой требуется откатиться.
- `username` (обязательный) : Имя пользователя.


```yaml
PUT /api/tenders/8ff28183-3d7e-41fd-ba97-f23cef173c9a/rollback/1?username=user1

Response:

  200 OK

  Body: 
{
    "id": "8ff28183-3d7e-41fd-ba97-f23cef173c9a",
    "version": 2, 
    "description": "Доставка вкусных пончиков",
    "name": "Тендер 1",
    "creatorUsername": "user1",
    "organization_id": "550e8400-e29b-41d4-a716-446655440020",
    "tender_status": "Published",
    "created_at": "2024-09-16T13:30:34.615+0000"
}

Версия все равно не 1, а 2, поскольку мы изменяли состояние тендера (откатились).
```

### 3. Тестирование функциональности предложений

#### 8. Создание нового предложения
- **Эндпоинт:** POST /bids/new
- **Описание:** Создает новое предложение для существующего тендера.
- **Примечание:** Если юзер создает предложение от своего имени - ему не нужны права доступа к организации.

```yaml
POST /api/bids/new

Request Body:

{
   "name": "Велосипед",
   "description": "Мы сможем доставлять ваши вкусные пончики куда угодно всего за 5 минут",
   "tenderId": "8ff28183-3d7e-41fd-ba97-f23cef173c9a",
   "authorType": "Organization",
   "authorId": "550e8400-e29b-41d4-a716-446655440002"
}
Response:

  200 OK

  Body: 
{
    "id": "31bc883c-eba2-4d7a-bee5-32e70571ef2d",
    "name": "Велосипед",
    "status": "Created",
    "authorType": "Organization",
    "authorID": "550e8400-e29b-41d4-a716-446655440002",
    "version": 1,
    "created_at": "2024-09-16T11:51:24.806+0000"
}
```

#### 9. Получение списка предложений пользователя
- **Эндпоинт:** GET /bids/my
- **Описание:** Возвращает список предложений текущего пользователя.
#### Параметры запроса:
- `limit` (опционально, по умолчанию: 5): Ограничивает количество возвращаемых предложений.
- `offset` (опционально, по умолчанию: 0): Указывает смещение для получения последующих записей.
- `username` : Имя пользователя.
```yaml

GET /api/bids/my?username=user5

Response:

  200 OK

  Body:
   [
       {
           "id": "5b451525-e7f3-4664-8163-0fe26aeb7c62",
           "name": "Велосипед",
           "status": "Created",
           "authorType": "User",
           "authorID": "550e8400-e29b-41d4-a716-446655440005",
           "version": 1,
           "created_at": "2024-09-16T12:01:58.750+0000"
       }
   ]
```
  
#### 10. Получение текущего статуса предложения
- **Эндпоинт:** GET /bids/{bidId}/status
- **Описание:** Возвращает статус предложения.
#### Параметры запроса:
- `bidId` : ID предложения.         - Path variable / String
- `username` : Имя пользователя.
  
```yaml
GET /api/bids/5b451525-e7f3-4664-8163-0fe26aeb7c62/status?username=user5

Response:

  200 OK

  Body:
     "Created"
```

#### 11. Получение списка предложений для тендера
- **Эндпоинт:** GET /bids/{tenderId}/list
- **Описание:** Возвращает предложения, связанные с указанным тендером. Узнать их может только ответственный за организацию.
#### Параметры запроса:
- `limit` (опционально, по умолчанию: 5): Ограничивает количество возвращаемых предложений.
- `offset` (опционально, по умолчанию: 0): Указывает смещение для получения последующих записей.
- `username` : Имя пользователя.
  
```yaml
GET /api/bids/8ff28183-3d7e-41fd-ba97-f23cef173c9a/list?username=user1

Response:

  200 OK

  Body:
[
    {
        "id": "31bc883c-eba2-4d7a-bee5-32e70571ef2d",
        "name": "Велосипед",
        "status": "Created",
        "authorType": "Organization",
        "authorID": "550e8400-e29b-41d4-a716-446655440002",
        "version": 1,
        "created_at": "2024-09-16T11:51:24.806+0000"
    },
    {
        "id": "5b451525-e7f3-4664-8163-0fe26aeb7c62",
        "name": "Велосипед",
        "status": "Created",
        "authorType": "User",
        "authorID": "550e8400-e29b-41d4-a716-446655440005",
        "version": 1,
        "created_at": "2024-09-16T12:01:58.750+0000"
    }
]
```

#### 12. Редактирование предложения
- **Эндпоинт:** PUT /bids/{bidId}/status
- **Описание:** Редактирование существующего предложения. Редактировать предложение может только либо сам юзер, либо ответственный за организацию.
#### Параметры запроса:
- `bidId` : ID предложения.         - Path variable / String
- `username` : Имя пользователя.
- `status` : Статус, на который пользователь хочет изменить статус своего предложения.
  
```yaml
PUT /api/bids/31bc883c-eba2-4d7a-bee5-32e70571ef2d/status?username=user2&status=Published

Response:

  200 OK

  Body: 
{
    "id": "31bc883c-eba2-4d7a-bee5-32e70571ef2d",
    "name": "Велосипед",
    "status": "Published",
    "authorType": "Organization",
    "authorID": "550e8400-e29b-41d4-a716-446655440002",
    "version": 1,
    "created_at": "2024-09-16T11:51:24.806+0000"
}
```

#### 13. Создание нового предложения
- **Эндпоинт:** PATCH /bids/{bidID}/edit
- **Описание:** Изменяет параметры предложения. Доступ есть только либо у юзера, либо у ответственного от организации. После изменения версия увеличивается.
#### Параметры запроса:
- `bidId` : ID предложения.         - Path variable / String
- `username` : Имя пользователя.         - Query / String

  
```yaml
POST /api/bids/5b451525-e7f3-4664-8163-0fe26aeb7c62/edit?username=user5

Request Body:

{
  "name": "Кубер",
  "description": "Я теперь не велосипед, а кубер !!"
}

Response:

  200 OK

  Body: 
{
    "id": "5b451525-e7f3-4664-8163-0fe26aeb7c62",
    "name": "Кубер",
    "status": "Created",
    "authorType": "User",
    "authorID": "550e8400-e29b-41d4-a716-446655440005",
    "version": 2,
    "created_at": "2024-09-16T12:01:58.750+0000"
}
```

#### 14. Отправка решения по предложению (КВОРУМ)
- **Эндпоинт:** PUT /bids/{bidId}/submit_decision
- **Описание:** Реализована система кворума: пользователи, относящиеся к организации могут отправлять свои решения по предложению. По достижению некоторого числа голосов *ЗА* (задается внутри класса -- константа. в данном случае - 3) решение будет принято. Если хотя бы один пользователь отправит решение *ПРОТИВ* - предложение автоматически считается отклоненным. Если решение по предложению уже вынесено - отправить новое уже невозможно.
#### Параметры запроса:
- `bidId` : ID предложения.         - Path variable / String
- `username` : Имя пользователя.         - Query / String
- `decision`: Решение пользователя.         - Query / String

  
```yaml
PUT /api/bids/5b451525-e7f3-4664-8163-0fe26aeb7c62/submit_decision?username=user1&decision=Approved

Response:

  200 OK

  Body: 
   Предложение успешно отправлено.


Если решение уже вынесено:
409 CONFLICT
{
    "reason": "Решение по данному предложению уже сделано. Rejected"
}

```

#### 15. Отправка отзыва по предложению
- **Эндпоинт:** PUT /bids/{bidId}/feedback
- **Описание:** Ответственный за организацию может отправить отзыв по предложению на тендер компании. Отзыв отправялется один раз на один тендер.
#### Параметры запроса:
- `bidId` : ID предложения.         - Path variable / String
- `username` : Имя пользователя.         - Query / String
- `bidFeedback`: Отзыв по предложению.         - Query / String

  
```yaml
PUT /api/bids/5b451525-e7f3-4664-8163-0fe26aeb7c62/feedback?username=user1&bidFeedback=Странный тип. Не связывайтесь с ним лучше..

Response:

  200 OK

  Body: 
      Отзыв успешно отправлен.
```

#### 16. Откат версии предложения
- **Эндпоинт:** PUT /bids/{bidId}/rollback/{version}
- **Описание:** Откатить параметры предложения к указанной версии. Это может ответственный за организацию, либо сам юзер.
#### Параметры запроса:
- `bidId` : ID предложения.         - Path variable / String
- `username` : Имя пользователя.
- `version`: Версия к которой требуется откатиться.

  
```yaml
PUT /api/bids/5b451525-e7f3-4664-8163-0fe26aeb7c62/rollback/1?username=user5

Response:

  200 OK

  Body: 
{
    "id": "5b451525-e7f3-4664-8163-0fe26aeb7c62",
    "name": "Велосипед",
    "status": "Created",
    "authorType": "User",
    "authorID": "550e8400-e29b-41d4-a716-446655440005",
    "version": 3,
    "created_at": "2024-09-16T12:01:58.750+0000"
}
```

### 4. Тестирование функциональности отзывов

#### 17. Просмотр отзывов на прошлые предложения
- **Эндпоинт:** GET /bids/{tenderId}/reviews
- **Описание:** Ответственный за организацию может посмотреть прошлые отзывы на предложения автора, который создал предложение для его тендера.

**Например:**
   User3 создал тендер. User2 решил отправить предложение на этот тендер. User3 отправляет отзыв на предложение, которое создал User2.
   
   Теперь тендер создает User1 *(он отвественный за свою организацию)*. User2 также создал предложение на этот тендер. User1 может этим запросом посмотреть отзыв User3 на предложение User2 по тому тендеру.

#### Параметры запроса:
- `tenderId` : ID тендера, на который пришло предложение.         - Path variable / String
- `authorUsername` : Имя автора, отправившего предложение на тендер компании.
- `requesterUsername`: Имя ответственного от организации лица.
- `limit` (опционально, по умолчанию: 5): Ограничивает количество возвращаемых предложений.
- `offset` (опционально, по умолчанию: 0): Указывает смещение для получения последующих записей.

```yaml
GET /api/bids/8ff28183-3d7e-41fd-ba97-f23cef173c9a/reviews?authorUsername=user5&requesterUsername=user1

Response:

  200 OK

  Body: 
  [
    {
        "id": "5a04e545-c4a5-4721-982d-d65185b18095",
        "description": "Странный тип. Не связывайтесь с ним лучше..",
        "createdAt": "2024-09-16T13:13:50.098+0000",
        "bid": {
            "id": "5b451525-e7f3-4664-8163-0fe26aeb7c62",
            "name": "Кубер",
            "status": "Created",
            "authorType": "User",
            "authorID": "550e8400-e29b-41d4-a716-446655440005",
            "version": 2,
            "created_at": "2024-09-16T12:01:58.750+0000"
        }
    }
]
```
